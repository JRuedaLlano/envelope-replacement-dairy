# Envelope Replacement Rule — Dairy Simulation Package

This repository contains the simulation and analysis code used in Section 7 of the manuscript:

> Rueda-Llano, J. (2025). *A renewal–reward envelope approach to optimal replacement.*  
> Manuscript submitted for publication.

The scripts generate synthetic dairy cumulative-profit trajectories, construct cubic surrogate
functions, compute envelope-based replacement indices, and export all LaTeX tables used in the
paper.

---

## Repository structure

```text
.
├── dairy_envelope_application.py    # Main simulation + baseline and weaker heifer scenarios
├── dairy_envelope_robustness.py     # Optional robustness experiments
├── dairy_envelope_tables.py         # Formatting/export of LaTeX tables
├── data/                            # Generated synthetic profit curves and scenario results
├── tables/                          # LaTeX tables included in the manuscript
├── requirements.txt
└── README.md
```

---

## Requirements

Python ≥ 3.10

Required packages:

numpy

pandas

matplotlib


Install dependencies:

```bash
pip install -r requirements.txt
```

---

## How to reproduce the simulation study

### 1. Generate synthetic economic data and compute envelope-rule decisions

Run:

```bash
python dairy_envelope_application.py
```

This script:

- Simulates ten cow cumulative-profit trajectories

- Simulates a baseline heifer benchmark

- Constructs a weaker heifer benchmark for sensitivity analysis

- Fits cubic surrogate functions

- Computes:

    - Cow-only optimal ages

    - Switch ages

    - Average-profit indices

    - Envelope-based optimal ages

- Exports the per-cow daily CSVs, scenario summary CSVs, and figures used to build the LaTeX tables in Section 7

    - Outputs are written to:

        Baseline scenario:

            - data/S0_baseline/section7_summary_baseline.csv

            - data/S0_baseline/01_cow_<id>_daily.csv, …, 10_cow_<id>_daily.csv

            - data/S0_baseline/01_fig_S0_baseline_cow_<id>.pdf/.png, ...

        Weaker heifer scenario:

            - data/S1_weaker/section7_summary_weaker.csv

            - data/S1_weaker/01_cow_<id>_daily.csv, …

            - data/S1_weaker/01_fig_S1_weaker_cow_<id>.pdf/.png, …

        These files are the input for both the LaTeX tables and the robustness analysis.


### 2. (Optional) Run additional robustness experiments

Run: 

```bash
python dairy_envelope_robustness.py
```

This script:

- Reads the per-cow daily CSVs and summary CSVs produced in step 1
    from data/S0_baseline/ and data/S1_weaker/.

- Applies a battery of small perturbations (e.g., noise on milk,
    margin shifts, benchmark shifts, tail truncation).

- Recomputes envelope decisions under each perturbation.

- Outputs are written into the same scenario folders under data/, for example:

    - data/S0_baseline/sec7_robustness_baseline.csv

    - data/S0_baseline/sec7_summary_baseline.tex

    - data/S0_baseline/sec7_branch_flips_baseline.tex

    - data/S0_baseline/sec7_diagnostics_baseline.(pdf|png)

    - data/S0_baseline/sec7_fliprates_baseline.(pdf|png)

and analogously for S1_weaker. These files support the robustness discussion and
can be supplied as supplementary material. They are not needed to regenerate
the main tables.


### 3. Build LaTeX tables 

Run:

```bash
python dairy_envelope_tables.py
```

This script:

- Loads:

    - data/S0_baseline/section7_summary_baseline.csv

    - data/S1_weaker/section7_summary_weaker.csv

- Constructs the tables used in the manuscript (per-cow tables, summary statistics,
and the baseline–weaker comparison).

- Outputs are written to the tables/ directory:

    - tables/table_section7_percow_baseline.tex

    - tables/table_section7_percow_weaker.tex

    - tables/table_section7_summary_baseline.tex

    - tables/table_section7_summary_weaker.tex

    - tables/table_section7_scenarios_compare.tex

These can be included directly in the LaTeX source via \input{...}.

---

## Description of the synthetic data

All data are synthetic and generated exclusively for illustrating the envelope
replacement rule. No real farm data are used.

The economic components reflect stylized dairy economics:

- Milk revenue net of variable feed costs.

- Lactation curves with parity effects and a unimodal peak structure.

- Maintenance and stall fixed costs.

- Heifer rearing cost and salvage value at replacement.

The code uses explicit random seeds so that, with the same Python and package
versions, results are reproducible.

---

## Data availability

All data required to reproduce the simulation results are generated by
dairy_envelope_application.py and stored under:

- data/S0_baseline/

- data/S1_weaker/

No external datasets are required.

---

## Code availability

All scripts used to produce the results in the manuscript are included in this
repository and rely only on standard open-source Python libraries
(numpy, pandas, matplotlib).

---

## Citation

If you use this repository, please cite:

Rueda-Llano, J. (2025).
A renewal–reward envelope approach to optimal replacement.
Manuscript submitted for publication.

---

## License

This project is released under the MIT License. See the `LICENSE` file for details.

---

## Contact

José Rueda-Llano
Friedrich Schiller University Jena
Email: jose.rueda.llano@uni-jena.de
